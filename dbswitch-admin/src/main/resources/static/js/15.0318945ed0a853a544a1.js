webpackJsonp([15],{ZxIL:function(t,a){},"mKp/":function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=e("mvHQ"),n=e.n(s),i={data:function(){return{loading:!0,currentPage:1,pageSize:10,totalCount:0,currentTaskAssignmentPage:1,currentTaskAssignmentPageSize:10,keyword:null,pageTaskAssignments:[],pageTaskAssignmentsTotalCount:0,taskId:0,taskName:"",jobTableData:[],jobScheduleTime:"",isActive:-1,array:[],dialogShowLogVisible:!1,logContent:"",jobId:0,baseId:0,status:0,timer:null}},methods:{loadPageTaskAssignments:function(){var t=this;this.$http({method:"POST",headers:{"Content-Type":"application/json"},url:"/dbswitch/admin/api/v1/assignment/list",data:n()({searchText:this.keyword,page:this.currentTaskAssignmentPage,size:this.currentTaskAssignmentPageSize})}).then(function(a){0===a.data.code?(t.pageTaskAssignments=a.data.data,t.pageTaskAssignmentsTotalCount=a.data.pagination.total):a.data.message&&alert("初始化任务安排信息失败:"+a.data.message)})},changeSearchKeyword:function(){this.currentTaskAssignmentPage=1,this.loadPageTaskAssignments()},handleLoadPageTaskAssignments:function(t){this.currentTaskAssignmentPage=t,this.loadPageTaskAssignments()},handleLoadPageTaskAssignmentsSizeChange:function(t){this.currentTaskAssignmentPageSize=t,this.loadPageTaskAssignments()},handleClose:function(){},handleSizeChange:function(t){this.loading=!0,this.pageSize=t,this.loadJobsData()},handleCurrentChange:function(t){this.loading=!0,this.currentPage=t,this.loadJobsData()},loadTaskInfo:function(){var t=this;this.taskId&&this.taskId>0&&this.$http.get("/dbswitch/admin/api/v1/assignment/info/id/"+this.taskId).then(function(a){0===a.data.code?t.taskName=a.data.data.name:a.data.message&&alert("查询任务详情失败,"+a.data.message)})},loadJobsData:function(){var t=this;this.taskId&&this.taskId>0&&this.$http.get("/dbswitch/admin/api/v1/ops/jobs/list/"+this.currentPage+"/"+this.pageSize+"?id="+this.taskId).then(function(a){0===a.data.code?(t.currentPage=a.data.pagination.page,t.pageSize=a.data.pagination.size,t.totalCount=a.data.pagination.total,t.jobTableData=a.data.data):a.data.message&&alert("查询JOB执行历史纪录失败,"+a.data.message)})},handleChooseClick:function(t,a){this.isActive=a,this.taskId=t,this.loadTaskInfo(),this.loadJobsData()},handleClickRefresh:function(){!this.taskId||this.taskId<0?alert("请先在左侧选择一个任务来"):(this.loadTaskInfo(),this.loadJobsData())},handleCancelJob:function(t){var a=this;this.$http.get("/dbswitch/admin/api/v1/ops/job/cancel?id="+t).then(function(t){if(0===t.data.code){var e=document.getElementById("butten_cancel_id");e.value="已取消",e.disabled=!0,a.$message("停止JOB成功"),a.loadJobsData()}else t.data.message&&alert("JOB停止失败,"+t.data.message)})},handleShowJobLogs:function(t){var a=this;this.dialogShowLogVisible=!0,this.jobId=t,this.$http.get("/dbswitch/admin/api/v1/ops/job/logs/tail?id="+t+"&size=500").then(function(t){if(0===t.data.code){var e=t.data.data.logs;a.status=t.data.data.status,a.baseId=t.data.data.maxId,a.logContent=e.join(""),a.scrollMaxheight(),1===t.data.data.status&&(a.timer=setInterval(function(){a.timerRefreshLogs()},1e3))}else t.data.message&&alert("加载JOB执行日志失败,"+t.data.message)})},timerRefreshLogs:function(){var t=this;this.$http.get("/dbswitch/admin/api/v1/ops/job/logs/next?id="+this.jobId+"&baseId="+this.baseId).then(function(a){if(0===a.data.code){var e=a.data.data.logs;t.logContent=t.logContent+e.join(""),t.baseId=a.data.data.maxId,t.status=a.data.data.status,t.scrollMaxheight(),1!==a.data.data.status&&(clearInterval(t.timer),t.timer=null)}})},scrollMaxheight:function(){this.$nextTick(function(){setTimeout(function(){var t=document.getElementById("log_textarea_id");t.scrollTop=t.scrollHeight},13)})},handleCloseLogDialog:function(){this.dialogShowLogVisible=!1,clearInterval(this.timer),this.timer=null}},created:function(){this.loadPageTaskAssignments(),this.$route.query.id&&(this.taskId=this.$route.query.id,this.loadTaskInfo(),this.loadJobsData())},beforeDestroy:function(){this.timer&&clearInterval(this.timer)}},o={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("el-card",[e("div",{staticClass:"container"},[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("任务安排列表")]),t._v(" "),e("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入关键字搜索",clearable:!0},on:{change:t.changeSearchKeyword},model:{value:t.keyword,callback:function(a){t.keyword=a},expression:"keyword"}})],1),t._v(" "),e("div",{staticClass:"navsBox"},[e("ul",t._l(t.pageTaskAssignments,function(a,s){return e("li",{key:s,class:{active:s==t.isActive},on:{click:function(e){return t.handleChooseClick(a.id,s)}}},[t._v("["+t._s(a.id)+"]"+t._s(a.name))])}),0),t._v(" "),e("el-pagination",{attrs:{small:"",layout:"sizes, prev, pager, next","current-page":t.currentTaskAssignmentPage,"page-sizes":[10,15,20],"page-size":t.currentTaskAssignmentPageSize,total:t.pageTaskAssignmentsTotalCount},on:{"current-change":t.handleLoadPageTaskAssignments,"size-change":t.handleLoadPageTaskAssignmentsSizeChange}})],1)]),t._v(" "),e("div",{staticClass:"contentBox"},[t.taskId&&t.taskId>0?e("el-tag",[t._v("当前任务：["+t._s(t.taskId)+"]"+t._s(t.taskName))]):t._e(),t._v(" "),e("div",{staticClass:"right-refresh-button"},[e("el-button",{attrs:{type:"primary",plain:"",size:"mini",icon:"el-icon-refresh",round:""},on:{click:t.handleClickRefresh}},[t._v("刷新")])],1),t._v(" "),e("el-table",{attrs:{"header-cell-style":{background:"#eef1f6",color:"#606266"},data:t.jobTableData,size:"small",border:""}},[e("template",{slot:"empty"},[e("span",[t._v("记录为空，或者单击左侧任务列表记录来查看作业调度记录")])]),t._v(" "),e("el-table-column",{attrs:{property:"jobId",label:"ID","min-width":"10%"}}),t._v(" "),e("el-table-column",{attrs:{property:"scheduleMode",label:"调度方式","min-width":"15%"}}),t._v(" "),e("el-table-column",{attrs:{property:"startTime",label:"开始时间","min-width":"25%"}}),t._v(" "),e("el-table-column",{attrs:{property:"finishTime",label:"结束时间","min-width":"25%"}}),t._v(" "),e("el-table-column",{attrs:{property:"duration",label:"持续时长(s)","min-width":"15%"}}),t._v(" "),e("el-table-column",{attrs:{property:"jobStatus",label:"执行状态","min-width":"15%"}}),t._v(" "),e("el-table-column",{attrs:{label:"日志","min-width":"15%"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{size:"mini",type:"success",round:""},on:{click:function(e){return t.handleShowJobLogs(a.row.jobId)}}},[e("i",{staticClass:"el-icon-view el-icon--right"},[t._v("查看")])])]}}])})],2),t._v(" "),e("div",{staticClass:"page",attrs:{align:"right"}},[e("el-pagination",{attrs:{"current-page":t.currentPage,"page-sizes":[5,10,20,40],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.totalCount},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1),t._v(" "),e("el-dialog",{attrs:{title:"日志详情",visible:t.dialogShowLogVisible,showClose:!1,"before-close":t.handleClose},on:{"update:visible":function(a){t.dialogShowLogVisible=a}}},[0===t.status?e("el-alert",{attrs:{title:"未执行",type:"info",center:"","show-icon":""}}):t._e(),t._v(" "),1===t.status?e("el-alert",{attrs:{title:"执行中",type:"success",center:"","show-icon":""}}):t._e(),t._v(" "),2===t.status?e("el-alert",{attrs:{title:"执行失败",type:"error",center:"","show-icon":""}}):t._e(),t._v(" "),3===t.status?e("el-alert",{attrs:{title:"执行成功",type:"success",center:"","show-icon":""}}):t._e(),t._v(" "),4===t.status?e("el-alert",{attrs:{title:"手动取消",type:"warning",center:"","show-icon":""}}):t._e(),t._v(" "),e("el-input",{staticClass:"log_textarea_style",attrs:{type:"textarea",id:"log_textarea_id",rows:20,spellcheck:!1},model:{value:t.logContent,callback:function(a){t.logContent=a},expression:"logContent"}}),t._v(" "),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},["1"==t.status?e("el-button",{attrs:{size:"small",id:"butten_cancel_id",type:"danger"},on:{click:function(a){return t.handleCancelJob(t.jobId)}}},[t._v("\n            终 止\n          ")]):t._e(),t._v(" "),e("el-button",{attrs:{size:"small",type:"success"},on:{click:t.handleCloseLogDialog}},[t._v("关 闭")])],1)],1)],1)])],1)},staticRenderFns:[]};var l=e("VU/8")(i,o,!1,function(t){e("ZxIL")},"data-v-4bb3a77c",null);a.default=l.exports}});
//# sourceMappingURL=15.0318945ed0a853a544a1.js.map